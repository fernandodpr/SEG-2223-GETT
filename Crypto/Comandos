Crea un nuevo key y prepara el CSR PARA EL CA
openssl req -new -config root-ca2.conf -out root-ca.csr \

Firmar el CSR del CA y añadirlo a la DB
openssl ca -selfsign -config root-ca.conf -in root-ca.csr -out root-ca.crt -extensions ca_ext



Ahora voy a crear un sub CA
Es necesario editar la configuración del sub-ca

Nuevo CSR para firmar con el CA
openssl req -new     -config sub-ca.conf     -out servidor-sub-ca.csr     -keyout private/servidor-sub-ca.key

En el Root CA firmamos la req
openssl ca -config root-ca.conf -in ../sub-ca/sub-ca.csr -out ../sub-ca/sub-ca.crt -extensions sub_ca_ext -days 365

    Step 12: OpenSSL Create Certificate Chain (Certificate Bundle)
    To openssl create certificate chain (certificate bundle), concatenate the intermediate and root certificates together.

In the below example I have combined my Root and Intermediate CA certificates to openssl create certificate chain in Linux. We will use this file later to verify certificates signed by the intermediate CA.
cat intermediate/certs/intermediate.cacert.pem certs/cacert.pem > intermediate/certs/ca-chain-bundle.cert.pem



Crear Nuevos certificados
openssl req -new -out Cliente-Sign.csr     -keyout Cliente-Sign.key
Firmarlos en el sub_ca


ES PO Vigo Seguridad Fernando Juan Pedro Server-Sign Server-Auth
openssl req -new -out Server-Sign.csr     -keyout Server-Sign.key
openssl req -new -out Server-Auth.csr     -keyout Server-Auth.key
openssl ca -config servidor-sub-ca.conf -in ../Servidor/Server-Sign.csr -out ../Servidor/Server-Sign.crt -extensions sign
openssl ca -config servidor-sub-ca.conf -in ../Servidor/Server-Auth.csr -out ../Servidor/Server-Auth.crt -extensions auth


ES PO Vigo Seguridad Fernando Juan Pedro Cliente-Sign Cliente-Auth
openssl req -new -out Cliente-Sign.csr     -keyout Cliente-Sign.key
openssl req -new -out Cliente-Auth.csr     -keyout Cliente-Auth.key
openssl ca -config cliente-sub-ca.conf -in ../Cliente/Cliente-Sign.csr -out ../Cliente/Cliente-Sign.crt -extensions sign
openssl ca -config cliente-sub-ca.conf -in ../Cliente/Cliente-Auth.csr -out ../Cliente/Cliente-Auth.crt -extensions auth