Datos para los certificados a partir de Ahora
C=ES
ST=PO
O=GETTSEG2022 FdPR PBC JBS

ClienteSimple-Auth

Crea un nuevo key y prepara el CSR PARA EL CA
openssl req -new -config root-ca2.conf -out root-ca.csr \

Firmar el CSR del CA y añadirlo a la DB
openssl ca -selfsign -config root-ca.conf -in root-ca.csr -out root-ca.crt -extensions ca_ext



Ahora voy a crear un sub CA
Es necesario editar la configuración del sub-ca

Nuevo CSR para firmar con el CA
openssl req -new     -config sub-ca.conf     -out servidor-sub-ca.csr     -keyout private/servidor-sub-ca.key

En el Root CA firmamos la req
openssl ca -config root-ca.conf -in ../sub-ca/sub-ca.csr -out ../sub-ca/sub-ca.crt -extensions sub_ca_ext -days 365

    Step 12: OpenSSL Create Certificate Chain (Certificate Bundle)
    To openssl create certificate chain (certificate bundle), concatenate the intermediate and root certificates together.

In the below example I have combined my Root and Intermediate CA certificates to openssl create certificate chain in Linux. We will use this file later to verify certificates signed by the intermediate CA.
cat intermediate/certs/intermediate.cacert.pem certs/cacert.pem > intermediate/certs/ca-chain-bundle.cert.pem



Crear Nuevos certificados
openssl req -new -out Cliente-Sign.csr     -keyout Cliente-Sign.key
Firmarlos en el sub_ca


ES PO Vigo Seguridad Fernando Juan Pedro Server-Sign Server-Auth
openssl req -new -out Server-Sign.csr     -keyout Server-Sign.key
openssl req -new -out Server-Auth.csr     -keyout Server-Auth.key
openssl ca -config servidor-sub-ca.conf -in ../Servidor/Server-Sign.csr -out ../Servidor/Server-Sign.crt -extensions sign
openssl ca -config servidor-sub-ca.conf -in ../Servidor/Server-Auth.csr -out ../Servidor/Server-Auth.crt -extensions auth


ES PO Vigo Seguridad Fernando Juan Pedro Cliente-Sign Cliente-Auth
openssl req -new -out Cliente-Sign.csr     -keyout Cliente-Sign.key
openssl req -new -out Cliente-Auth.csr     -keyout Cliente-Auth.key
openssl ca -config cliente-sub-ca.conf -in ../Cliente/Cliente-Sign.csr -out ../Cliente/Cliente-Sign.crt -extensions sign
openssl ca -config cliente-sub-ca.conf -in ../Cliente/Cliente-Auth.csr -out ../Cliente/Cliente-Auth.crt -extensions auth


PARA OCSR
OCSR de root CA
    cd /root-ca
        openssl req -new -newkey rsa:2048 -subj "/C=ES/O=Juan y Fernando SEG/CN=OCSP ROOT RESPONDER" -keyout private/root-ocsp.key -out root-ocsp.csr
        openssl ca -config root-ca.conf -in root-ocsp.csr -out root-ocsp.crt -extensions ocsp_ext -days 30
        LEVANTAR EL SERVICIO
        openssl ocsp -port 8092 -index db/index -rsigner root-ocsp.crt -rkey private/root-ocsp.key -CA root-ca.crt -text
        openssl ocsp -issuer root-ca.crt -CAfile root-ca.crt -cert root-ocsp.crt -url http://localhost:8092
    cd /sub-ca server
        openssl req -new -newkey rsa:2048 -subj "/C=ES/O=Juan y Fernando SEG/CN=OCSP sub-ca-server RESPONDER" -keyout private/sub-ca-server-ocsp.key -out sub-ca-server-ocsp.csr
        openssl ca -config servidor-sub-ca.conf -in sub-ca-server-ocsp.csr -out sub-ca-server-ocsp.crt -extensions ocsp_ext -days 30
        LEVANTAR EL SERVICIO
        openssl ocsp -port 8092 -index db/index -rsigner sub-ca-server-ocsp.crt -rkey private/sub-ca-server-ocsp.key -CA servidor-sub-ca.crt -text
        openssl ocsp -issuer servidor-sub-ca.crt -CAfile servidor-sub-ca.crt -cert sub-ca-server-ocsp.crt -url http://localhost:8092
        openssl ocsp -issuer servidor-sub-ca.crt -CAfile ../root-ca/root-ca.crt -cert sub-ca-server-ocsp.crt -url http://localhost:8092
        openssl ocsp -issuer servidor-sub-ca.crt -CAfile ../root-ca/root-ca.crt -cert ../Servidor/Server-Auth.crt -url http://localhost:8092



Para revocar un certificados

openssl ca -config root-ca.conf -revoke certs/1009.pem -crl_reason keyCompromise

java server ./Crypto/ServerSimple/KeyStoreServidorAuth ./Crypto/ServerSimple/KeyStoreServidor